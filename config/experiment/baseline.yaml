# @package _global_

defaults:
  - override /dataset: re10k
  - override /dataset/view_sampler: bounded
  - override /model/scheduler: ddpm_eps
  - override /model/denoiser: mv_unet
  - override /model/denoiser/multi_view_attention: spatial_transformer_3d
  - override /model/autoencoder: kl_f8

dataset:
  image_shape: [256, 256] # [180, 320]
  random_transform_extrinsics: false
  # overfit_to_scene: 
  #   - 0a5eeb4466dd19bb
  view_sampler: 
    num_context_views: 2
    num_target_views: 3
    min_distance_between_context_views: 50
    max_distance_between_context_views: 180



wandb:
  tags: [re10k, 256x256]

  activated: true

freeze:
  denoiser: false

model:
  scheduler:
    num_inference_steps: 50
    beta_schedule:
      start: 0.0001
      end: 0.02
  denoiser:
    pretrained_from: /BS/grl-co3d/work/models--stabilityai--stable-diffusion-2-1/snapshots/5cae40e6a2745ae2b01ad92ae5043f95f23644d6
  diffusion_scale: 2.0
  ray_encodings: 
    num_origin_octaves: 15
    num_direction_octaves: 15
  conditional: true
  relative_camera: true
  use_cfg: true
  cfg_scale: 3.0
  cfg_train: true
  in_channels: 3
  out_channels: 3
  use_ray_encoding: false
  projected_noise: false
  srt_ray_encoding: false
  use_sd_vae: true
  use_plucker: false
data_loader:
  train:
    num_workers: 16
    persistent_workers: true
    batch_size: 6

  val:
    batch_size: 8
    # seed: 4444

trainer:
  max_steps: 5_000_001
  val_check_interval: 10000
  task_steps: null

  precision: 16-mixed

optimizer:
  name: AdamW
  lr: 2.0e-5

  scale_lr: false
  scheduler:
    name: LinearLR
    frequency: 1
    interval: step
    kwargs:
      start_factor: 5.e-4
      total_iters: 200

checkpointing:
  load: checkpoints/base_sd_vae_nosch_ddim_no_rayenc_3d/1000000.ckpt
  resume: false